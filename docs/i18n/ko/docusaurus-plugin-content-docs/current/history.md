# 실행 히스토리 관리

task-pipeliner는 워크플로우 실행 히스토리를 자동으로 기록하여 과거 실행 내역을 검토하고, 문제를 디버깅하며, 성능을 추적할 수 있게 해줍니다.

## 히스토리 자동 저장

모든 워크플로우 실행은 자동으로 `~/.pipeliner/workflow-history/` 디렉토리에 저장됩니다.

### 저장 위치

- **경로**: `~/.pipeliner/workflow-history/`
- **파일명 형식**: `workflow-YYYY-MM-DD_HH-mm-ss-<hash>.json`
  - 예: `workflow-2026-01-26_21-51-17-abc1.json`
- **정렬**: 타임스탬프 기준으로 최신순 정렬

### 히스토리 파일 구조

각 히스토리 파일은 다음 구조를 가집니다:

```json
{
  "initialTimestamp": 1706281877000,
  "records": [
    {
      "step": {
        "run": "npm install"
      },
      "context": {
        "workspace": {},
        "stepIndex": 0
      },
      "output": {
        "success": true,
        "stdout": ["...", "..."],
        "stderr": []
      },
      "duration": 1234,
      "status": "success"
    }
  ]
}
```

**필드 설명:**

- **`initialTimestamp`**: 워크플로우 실행 시작 시간 (Unix 타임스탬프, 밀리초)
- **`records`**: 각 단계의 실행 기록 배열
  - **`step`**: 실행된 단계 정의
  - **`context`**: 실행 컨텍스트 (워크스페이스 상태, 단계 인덱스 등)
  - **`output`**: 명령 출력
    - **`success`**: 성공 여부 (boolean)
    - **`stdout`**: 표준 출력 (string 배열)
    - **`stderr`**: 표준 에러 (string 배열)
  - **`duration`**: 실행 시간 (밀리초)
  - **`status`**: `"success"` 또는 `"failure"`

## 히스토리 보기

### 인터랙티브 메뉴

```bash
tp history
```

이 명령은 인터랙티브 메뉴를 표시합니다:

```
? 작업을 선택하세요:
  ❯ 보기 - 히스토리를 보고 선택하여 보기
    삭제 - 특정 히스토리 파일 삭제
    모두 삭제 - 모든 히스토리 파일 삭제
```

### 특정 히스토리 보기

```bash
tp history show
```

이 명령은:
1. 모든 히스토리 파일 목록을 표시합니다
2. 선택할 수 있는 메뉴를 제공합니다
3. 선택한 히스토리의 상세 정보를 표시합니다

**출력 예시:**

```
┌─────────────────────────────────────────┐
│  워크플로우 실행 히스토리                │
│                                         │
│  파일: workflow-2026-01-26_21-51-17...  │
│  시작: 2026-01-26 21:51:17               │
│  총 소요 시간: 5.23초                    │
│  총 단계: 3                              │
│  ✓ 성공: 2                               │
│  ✗ 실패: 1                               │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  ✓ 단계 1/3 - 실행                       │
│  소요 시간: 1.23초 | 상태: 성공           │
│                                         │
│  명령: npm install                       │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│  ✗ 단계 2/3 - 실행                       │
│  소요 시간: 0.45초 | 상태: 실패           │
│                                         │
│  명령: npm run build                     │
│                                         │
│  표준 에러:                              │
│    오류: 빌드 실패                       │
└─────────────────────────────────────────┘
```

## 히스토리 삭제

### 특정 히스토리 삭제

```bash
tp history remove
```

이 명령은:
1. 모든 히스토리 파일 목록을 표시합니다
2. 삭제할 히스토리를 선택할 수 있는 메뉴를 제공합니다
3. 선택한 히스토리 파일을 삭제합니다

### 모든 히스토리 삭제

```bash
tp history remove-all
```

이 명령은 모든 히스토리 파일을 삭제합니다. 확인 프롬프트가 표시됩니다:

```
? 모든 히스토리를 삭제하시겠습니까?
  ❯ 예, 모두 삭제
    아니오, 취소
```

확인 없이 바로 삭제하려면 `-y` 플래그를 사용하세요:

```bash
tp history remove-all -y
```

## 사용 사례

### 디버깅

과거 실행 내역을 검토하여 워크플로우가 실패한 이유를 파악할 수 있습니다:

```bash
# 최근 실행 내역 확인
tp history show

# 실패한 단계의 stderr 확인
# 히스토리 출력에서 Stderr 섹션 확인
```

### 성능 분석

각 단계의 실행 시간을 확인하여 병목 현상을 식별할 수 있습니다:

```bash
tp history show
# Duration 필드에서 각 단계의 실행 시간 확인
```

### 감사

모든 워크플로우 실행 기록을 유지하여 감사 목적으로 사용할 수 있습니다.

## 히스토리 파일 직접 접근

필요한 경우 히스토리 파일을 직접 읽을 수 있습니다:

```bash
# 히스토리 디렉토리 확인
ls ~/.pipeliner/workflow-history/

# 특정 히스토리 파일 읽기
cat ~/.pipeliner/workflow-history/workflow-2026-01-26_21-51-17-abc1.json
```

## 다음 단계

- **[DSL 참조](/docs/dsl-reference/workflow-structure)** - 워크플로우 문법 자세히 알아보기
- **[예제](/docs/examples)** - 실제 사용 사례 보기
