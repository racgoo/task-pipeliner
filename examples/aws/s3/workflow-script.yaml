name: AWS S3 Upload (Script)

# 1) Load credentials and bucket from env.example via cat + KV capture
# 2) Prompt for local file path and S3 object key
# 3) Upload using Node.js script (upload-s3.js) with AWS SDK
# Edit env.example with your values. Run from this directory. Requires: Node.js 18+, and run `npm install` once here.

baseDir: ./

steps:
  - run: 'cat env.example'
    captures:
      - kv: AWS_ACCESS_KEY_ID
        as: AWS_ACCESS_KEY_ID
      - kv: AWS_SECRET_ACCESS_KEY
        as: AWS_SECRET_ACCESS_KEY
      - kv: AWS_REGION
        as: AWS_REGION
      - kv: S3_BUCKET
        as: S3_BUCKET
  - prompt:
      message: "Local file to upload (e.g. sample.txt):"
      default: sample.txt
      as: upload_file
  - prompt:
      message: "S3 object key (path in bucket):"
      default: uploads/sample.txt
      as: s3_key
  - run: 'export AWS_ACCESS_KEY_ID="{{AWS_ACCESS_KEY_ID}}" AWS_SECRET_ACCESS_KEY="{{AWS_SECRET_ACCESS_KEY}}" AWS_REGION="{{AWS_REGION}}" S3_BUCKET="{{S3_BUCKET}}" && node upload-s3.js "{{upload_file}}" "{{s3_key}}"'
  - run: 'echo "Uploaded to s3://{{S3_BUCKET}}/{{s3_key}}"'
